# TCP/IP

TCP/IP提供点对点的链接机制，将数据应该如何封装，定址，传输，路由以及在目的地如何接收，都加以标准化。它将软件通信过程抽象化为四个抽象层，采取协议堆栈的方式，分别实现出不同通信协议。协议族下的各种协议，依其功能不同，被分别归属到这四个层次之中，常被视为是简化的七层OSI模型。

## 协议栈中的层
- 应用层
    应用层负责处理特定的应用程序细节
- 传输层
    主要为两台诗词主机上的应用程序提供端到端的通信,例如使用Tcp或Udp
- 网络互连层
    IP是一种网络层协议，提供的是一种不可靠的服务，它只是尽可能快地把分组从源结点送到目的结点，但是并不提供任何可靠性保证。同时被TCP和UDP使用。
- 网络接口层
    通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡

![分层](https://upload.wikimedia.org/wikipedia/commons/c/c4/IP_stack_connections.svg)
![分层](https://upload.wikimedia.org/wikipedia/commons/3/3b/UDP_encapsulation.svg)

## TCP(传输控制协义)

是一种面向连接的、可靠的、基于字节流的传输层通信协议。

### TCP为什么可靠
应用层向TCP层发送用于网间传输的、用8位字节表示的数据流，然后TCP把数据流分割成适当长度的报文段。之后TCP把结果包传给IP层，由它来通过网络将包传送给接收实体的TCP层。TCP为了保证不发生丢包，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的包发回一个相应的确认（ACK），如果发送端实体在合理的往返时延（RTT）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。TCP用一个校验和函数来检验数据是否有错误，在发送和接收时都要计算校验和。


### 运作方式
TCP协议的运行可划分为三个阶段：连接创建、数据传送和连接终止

### 创建连接
TCP用三次握手过程创建一个连接。
- 第一次

第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。
- 第二次

第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；
- 第三次

第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。

![三次握手](https://upload.wikimedia.org/wikipedia/commons/3/3f/Connection_TCP.png)

### 连接终止

连接终止使用了四次握手的过程，在这个过程中连接的每一侧都独立的被终止。当一个端点要停止它这一侧的连接，就向对侧发送FIN，对侧回复ACK表示确认。因此，拆掉一侧的连接过程需要一对FIN和ACK，分别由两侧端点发出。
![四次握手](https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/TCP_CLOSE.svg/375px-TCP_CLOSE.svg.png)

## IP(网际协义)


