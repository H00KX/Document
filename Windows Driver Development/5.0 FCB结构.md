## FCB (File Control Block)

用文件对象来代表一个文件是不现实的。因为同一个文件可能被多次打开，每次打开都能生成一个文件对象。

更合理的是使用FCB来代表一个文件。FCB是文件系统为每个撕开着的文件生成的一个内存区，保存维护这个文件所需要的数据。无论这个文件打开了多少次，都只有一个FCB。

FCB结构由文件对象中的`FsContext`字段指向。

**FCB 文件对象 和 文件句柄的关系**
- FCB对应一个已经被打开的实体的文件，用于文件系统维护文件。所有对某个文件的操作，本质上都会通过在FCB中记载的信息进行。
- 文件对象对应阗一个文件的一次打开。在打开时产生，在关闭时销毁，因此多个文件对象可以对应同一个FCB。文件对象的指针用来作为IRP的域之一发送文件请求（本质上文件系统收到请求后会通过FCB中保存的信息进行操作）。
- 文件句柄是从文件对象上获得的。一个文件对象可以被获得多个文件句柄，句柄一般用来在ZwWriteFile或者ZwReadFile之类的内核API中对文件进行操作。

共享FCB的所有操作都指向同一文件。FCB是文件操作的焦点。由于同一FCB上的操作实际上在同一文件上，因此同步基于FCB而不是某些更高级别的对象。
