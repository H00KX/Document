## 内存管理

32位的虚拟内存空间按照0--4G的线性地址看待。

任何一个进程都定义了它自己的完整的4G空间，但是，其2G-4G之间的部分是所有进程共享的，称为**系统地址空间**，而0-2G的部分才是它自己私有的，称为**进程地址空间**。

为了有效的管理2G系统地址空间，Windows在初始化时将这2G划分成了一些固定的区域，各个区域有专门的用途。而且，**Windows内核使用了一组全局变量来记录每个区域的边界**。所以，系统地址的初始化实际上是对这些全局变量的初始化，并相应的初始化每个区域。Windows的一些引导选项以及系统配置（位于注册表）可能会影响到某些区域的位置和大小。

> 系统空间中的主要区域包括：内核模块映像、PFN数据库、换页内存池、非换页内存池、会话空间、系统缓存区、系统PTE区域、系统视图以及页表等。

## 内存管理器

内存管理器有以下两个主要任务：
- 将一个进程的虚拟地址空间转译或者映射到物理内存中，这样，当一个在该进程的环境中运行的结各读写虚拟地址空间时，它可以引用到正确的物理地址[在一个进程的虚拟地址空间中，物理上驻留在内存中的那一部分子集被称为工作集]。
- 当内存被过度提交（也就是说，当运行结各或者系统代码试图使用比当前可用的量不过尔尔的物理内存）时，将内存中的有些内容转移到磁盘上；并且，在以后需要这些内容时，再将它们读回到物理内存中。

除了提供虚拟内存管理以外，内存管理器还提供了一组核心服务；
- 内存映射文件[在内部称为**内存区对象**]
- 写时复制内存
- 为应用程序使用大的、稀疏的地址空间提供支持
- 内存管理器提供了一种方法，使进程能够分配和使用的物理内存可以超过总共可被映射到进程虚拟地址空间中的大小（32位操作系统可以使用3G以上内存）

### 内存管理器组件
 内存管理器是Windows执行体的一部分，所以它位于文件Ntoskrnl.exe中。由以下组件构成：
 - 一组执行体系统服务，负责分配、释放和管理虚拟内存。绝大多数服务通过Windows API或者内核模式的设备驱动程序接口暴露出来。
