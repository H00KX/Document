# 对象管理


## 对象

这里的对象和`面向对象程序设计`所说的对象不一样。在Windows内核中，“对象”实际上就是数据结构，就是一些带有“对象头(Object Head)”的特殊数据结构。


任何对象的数据结构都由对象头和具体对象类型的数据结构两部分构成。

![对象数据结构图](./images/1576813763(1).jpg)


## 对象目录

参考 Winobj 这个软件去理解：

对象目录是多个“节点”连接而成的树状结构，树的极好是一个“目录”对象，即类型为`OBJECT_DIRECTORY`的对象。树中的每个节点都是对象，所以“节点名”就是“对象名”。除根节点之外，树中的所有中间节点都必须是目录对象或“符号链接”对象（即类型为`OBJECT_SYMBOLIC_LINK`的对象），而普通的对象则只能成为“叶节点”。


## 对象类型

对象是分类的，因而是有“类型（Type）”的。Windows对象类型的集合（对于内核）是开放的，内核函数可以向这个集合中加入新的对象类型。用户可以把内核模块即.sys模块动态安装到内核中，使其成为内核的一部分。这样，用户就实际上有了增加新对象的自由。

Windows内核为新对象类型的定义提供了一个全局的`OBJECT_TYPE_INITIALIZE`数据结构。

要定义即创建一种新的对象类型时，就需要填写好一个`OBJECT_TYPE_INITIALIZE`数据结构，然后调用`ObCreateObjectType()`。这个函数根据结构创建起新的对象类型的数据结构，然后将其挂入对象目录。对象类型的数据结构是`OBJECT_TYPE`，其内部有个成员`TypeInfo`也是`OBJECT_TYPE_INITIALIZE`数据结构，“申请单”的内容将被复制到`OBJECT_TYPE`数据结构内部的`TypeInfo`中。


## 句柄和句柄表

