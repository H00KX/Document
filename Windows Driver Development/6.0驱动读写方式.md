设备对象一共可以有三种读写方式，分别是缓冲区方式读写、直接方式读写、其他方式读写。

这三种方式的Flags分别对应为`DO_BUFFERD_IO`、`DO_DIRECT_IO`和0


## 缓冲区读写

以缓冲区方式写设备时，操作系统将WriteFile提供的用户模式的缓冲区复制到内核模式地址下。这个地址由WriteFile创建的IRP的AssociatedIrp.SystemBuffer子域记录。

优点：比较简单地解决了将用户地址传入驱动的问题。
缺点：需要在用户模式和内核模式之间复制数据，影响了运行效率。在少量内存操作时，可以采用这种办法。

## 直接方式读写

和缓冲区方式读写设备不同，直接方式读写设备，操作系统会将用户模式下的缓冲区锁住。然后操作系统将这段缓冲区在内核模式地址再映射一遍。这样，用户模式的缓冲区和内核模式的缓冲区指向的是同一区域的物理内存。无论操作系统如何切换进程，内核模式地址都保持不变。

操作系统先将用户模式的地址锁定后，操作系统用内存描述符表（MDL）记录这段内存。

[MDL](./MDL直接方式读写.md)
