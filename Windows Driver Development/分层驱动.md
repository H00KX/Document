# 分层驱动

分层驱动是指两个或两个以上的驱动程序，它们分别创建设备对象，一层一层地“挂载”在其他设备对象之上，并且形成一个 **由高到低的设备对象栈**。
**IRP请求一般会被传送到设备栈的最顶层的设备对象，顶层的设备对象可以选择直接结束IRP请求，也可以选择将IRP请求向下层的设备对象转发。**
**如果是向下层设备对象转发IRP请求，当IRP请求结束时，IRP会顺着设备栈的反方向原路返回。**
**当得知下层驱动程序已经结束IRP请求时，本层设备对象可以选择继续将IRP向上返回，或者选择重新将IRP再次传递给底层设备驱动。**

在`DEVICE_OBJECT`结构体中有AttachedDevice这个参数，记录了自己这个设备**被**哪一个设备对象所挂载。

![local image](./images/1543485831(1).jpg)
