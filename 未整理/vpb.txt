p371
卷设备对象表示装载的逻辑卷的实例。该设备对象由文件系统驱动程序实现创建； 

在访问存储设备上的文件系统数据之前，大多数操作系统通常需要装载操作，装载操作由平台上的文件系统驱动程序来执行。
装载卷的过程只是为了让文件系统驱动程序有机会为后续访问准备卷。


通常，文件系统驱动程序将首先检查磁盘上的数据结构，以确定要装载的介质是否包含有效的文件系统信息。如果这些检查通过，
文件系统将读入基本卷信息，如卷大小、根目录位置、空闲块映射、分配的群集映射等，然后创建必要的内存结构，用于支持对卷的访问。


在Windows NT系统下，I/O管理器要求创建一个代表装入的逻辑卷的设备对象（卷设备对象），
对于物理介质，与代表物理介质的设备对象相关联的VPB被正确初始化。
使用属于物理设备对象的VPB结构，每个卷设备对象在逻辑上与物理设备对象相关联。
这种关联发生在卷装载时，这种情况发生在输入/输出管理器收到驻留在物理设备对象上的对象的第一个创建/打开请求时。（应该是这个磁盘上的一个文件被打开或创建时）


流程：
1.例如，对“C:\dirl”的打开
2.输入/输出管理器获得一个指向VPB结构的指针，该结构与表示“C:”的物理设备对象相关联；
3.输入/输出管理器检查VPB中的“Flags”字段，查看物理设备对象是否存在已装入的逻辑卷；
4.如果(不存在已装入的卷，即未设置VPB _ MOUNTED)
4.1 输入/输出管理器请求每个文件系统（ntfs、fat32）检查它们是否希望在物理设备对象上执行装载
4.2 文件系统驱动程序之一执行装载操作；
4.3 作为“装载”过程的一部分，FSD将创建FILE_DEVICE_DISK_FILE_SYSTEM类型的设备对象或网络等效对象；
4.4 现在，VPB中的DeviceObject字段将指向逻辑卷设备对象(这是由执行装载的FSD完成的)；
4.5 有的文件系统为装载请求返回STATUS_SUCCESS 时，输入/输出管理器将在VPB的标志字段中设置VPB_MOUNTED标志
5. 现在，输入/输出管理器可以继续执行与创建/打开请求相关的其他指令

VPB已经是关联上物理设备对象了，就是在装载的时候创建对应的卷设备对象并关联。


p372
VPB
该结构在物理磁盘设备对象和逻辑卷设备对象之间创建逻辑关联的重要任务
VPB结构仅存在于可以装载的物理、虚拟和/或逻辑介质的设备对象中。
因此，如果您设计网络重定向器和/或服务器，您将不会直接与VPB结构交互。
注意，在物理设备对象和表示安装的逻辑卷设备对象之间没有物理关联
(即，没有指针从逻辑卷设备对象直接通向物理设备对象，反之亦然，这通常发生在两个设备对象通过连接操作连接时)
对于文件系统装载操作，两个设备对象之间的唯一关联是通过VPB结构的逻辑连接。
输入/输出管理器知道两个设备对象之间的逻辑关联，并且在收到对磁盘的创建/打开请求时，
总是检查VPB结构，以确定请求实际应该指向的文件系统卷设备对象。


p373
Also  note  that  each  file  object  structure  representing  a  successful  open  operationon  an  on-clisk  object  points  to  the  VPB  structure  belonging  to  the  physical  deviceon which the  opened  on-disk object  resides.
每个文件对象结构表示一个指向属于打开的磁盘的VPB结构的磁盘上对象的成功打开操作（其实就是一个磁盘上文件正确的打开生成了文件对象）

Volume  control block  (VCB)
作为装载过程的一部分，为了使文件系统能够有序、正确地访问逻辑卷中包含的数据。
维护的有助于此过程的结构之一是VCB结构

VCB结构包含诸如指向内存中根目录结构(即根目录的FCB)的指针、逻辑卷上当前打开的文件流的数量、表示逻辑卷在任何给定时刻的状态的一些标志、
用于保持VCB结构本身完整性的同步结构以及其他类似信息等基本信息

一般情况下，在创建逻辑卷设备对象时，VCB作为设备对象扩展的一部分


p374

